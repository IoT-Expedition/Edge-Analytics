<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Edge-analytics by IoT-Expedition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Edge-analytics</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/IoT-Expedition/Edge-Analytics" class="btn">View on GitHub</a>
      <a href="https://github.com/IoT-Expedition/Edge-Analytics/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/IoT-Expedition/Edge-Analytics/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="leveraging-edge-analytics-in-iot" class="anchor" href="#leveraging-edge-analytics-in-iot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Leveraging Edge-Analytics in IoT</h1>

<p><em>Knocking demo using the Giotto Stack.</em></p>

<hr>

<p>This is an open source application built on top of the GIoTTO stack to showcase how an IoT app can leverage the stack functionality to offer advanced features and complex interactions between multiple IoT entities. It also demonstrates how Edge Analytics reduces the end-to-end time required for IoT scenarios. The schematic diagram of the application is shown in Figure 1. </p>

<p><img src="https://github.com/IoT-Expedition/Edge-Analytics/blob/master/architecture.jpg" alt="Schemaic diagram of the knocking app."></p>

<h1>
<a id="required-devices" class="anchor" href="#required-devices" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Required Devices</h1>

<ul>
<li><a href="http://www.ti.com/tool/cc2541dk-sensor">TI sensor tag</a></li>
<li><a href="https://www.raspberrypi.org/blog/raspberry-pi-3-on-sale/">Raspberry PI</a></li>
<li>IP camera</li>
<li>Internet connection</li>
</ul>

<h1>
<a id="configuration-file" class="anchor" href="#configuration-file" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration file</h1>

<p>The <a href="./knocking.conf">knocking.conf</a> file holds the configurations required for the demo:</p>

<ul>
<li>camera_ip, the IoT camera IP in IPv4 format 0.0.0.0</li>
<li>BD_domain, url for buildingdepot</li>
<li>base_url, service url @ buildingdepot</li>
<li>res, checing resosultion, how frequent to check on the sensor data</li>
<li>knockingSensor_uuid, where knocking sensor posts time-series data</li>
<li>postSensor_uuid, where google cards information are posted</li>
</ul>

<h1>
<a id="giotto-stack-installation" class="anchor" href="#giotto-stack-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GIoTTO stack installation</h1>

<p>The entire GIoTTO stack can be downloaded <a href="http://cmu.buildingdepot.org/BuildingDepot.tar.gz">here</a>. For full description, installation guide and API documentation, please refer to the BuildingDepot <a href="http://buildingdepot.andrew.cmu.edu/">webpage</a>. Once installation is complete, you need to register with the platform and create a username and password. Use the registration credentials to login to the system and create 2 snesor IDs: <code>knockingSensor_uuid</code> to store the knocking sensor times series data and <code>postSensor_uuid</code> to post the Google Now card information. Copy the generated uuids of both sensors to respective lines in the <a href="./knocking.conf">knocking.conf</a>.</p>

<h1>
<a id="setting-up-the-knocking-virtual-sensor" class="anchor" href="#setting-up-the-knocking-virtual-sensor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting up the knocking virtual sensor</h1>

<p>The TI sensor tag is used to detect the knocking signal. The current version of the TI sensor tag can communicate only through BLE. Therefore, you need a gateway to commuincate the data generated by the sensor to the platfrom. As such, we use a Raspberry PI as a gateway. The mac address of the TI sensor tag is a constant in the file <a href="./virtual_sensor/virtualSensorMonitor.py">virtualSensorMonitor.py</a> as <code>DEFAULT_MAC_ADDRESS = "replace-with-your-sensor-mac-address"</code>. Make sure that the raspberry pi is connected to the Internet. We also need to translate the raw sensor data generated by the TI sensor resulting from the knocking signal into a meangful semantic infomration (e.g., knoking or silent). The machine leanring script in the <a href="./virtual_sensor">virtual_sensor</a> folder creates the required virtual sensor and post either "knocking" or "silent" to knockingSensor_uuid.</p>

<h1>
<a id="face-recognition-installation" class="anchor" href="#face-recognition-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Face recognition installation</h1>

<p>This demo uses OpenFace for face detection. OpenFace is a Python and Torch implementation of face recognition with deep neural networks. To install and setup OpenFace, please refer to the OpenFace guide in this <a href="http://cmusatyalab.github.io/openface/">link</a>. However, OpenFace is pre-installed with the <a href="http://cmu.buildingdepot.org/BuildingDepot.tar.gz">GIoTTO</a> distribution as a docker container. You can access Openface in this folder /srv/openface. Nevertheless, Openface can be installed on any server, but make sure to update the proper changes to reach the server ip/domain in the code.</p>

<h1>
<a id="generating-google-now-cards" class="anchor" href="#generating-google-now-cards" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generating Google Now cards</h1>

<p>Currently, the Google Now API is not avialable for public. You need to <a href="https://support.google.com/a/answer/60751?hl=en">whitelist your email with Google</a> to be ble to access their Now API. Then, you need to create an account with Google developer if you don't have one already. Once you register, you will receive a client id and a client secret tokens. Those go into <code>client_id</code> and <code>client_secret</code> parementers in the <a href="./client_secret.json">client_secret.json file</a>. You will need to request and access token and replace any <code>access_token</code> instance in the files: <a href="./makeCard.py">makeCard.py</a>. To get an access token, you just need to put your credentials in <a href="./refreshtoken.py">refreshtoken.py</a> file. Google cards in this demo contains actions buttons (e.g., call and send SMS). Some of these actions require background processing, which we provide in an Android app in this folder <a href="./AndroidDLApp">AndroidDLApp</a>. To succesfuly generate cards on a Google-whitelisted account, all card actions/conditions must be satisfied. Hence, you need to install this app on the mobile device participating in the demo. No need to run it though.</p>

<h1>
<a id="running-the-demo" class="anchor" href="#running-the-demo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running the demo</h1>

<ul>
<li>Make sure the the TI sensor tag is runing and the green light is flashing</li>
<li>Turn on the raspberry pi serving to the TI sensor tag and make sure that it is conneced to the internet (wired or wireless)</li>
<li>Run <a href="./virtual_sensor/virtualSensorMonitor.py">virtualSensorMonitor.py</a>
</li>
<li>Make sure that the camera is connected to the Internet.</li>
<li>Connect to the GIoTTO platform (i.e., server running BuildingDepot) and run the following commands:</li>
</ul>

<div class="highlight highlight-source-python"><pre>service docker restart
docker run <span class="pl-k">-</span>p <span class="pl-c1">9000</span>:<span class="pl-c1">9000</span> <span class="pl-k">-</span>p <span class="pl-c1">8000</span>:<span class="pl-c1">8000</span> <span class="pl-k">-</span>v <span class="pl-k">/</span>srv<span class="pl-k">/</span>buildingdepot<span class="pl-k">/</span>Documentation<span class="pl-k">/</span>build<span class="pl-k">/</span>html<span class="pl-k">/</span>:<span class="pl-k">/</span>var<span class="pl-k">/</span>www<span class="pl-k">/</span>html <span class="pl-k">-</span>t <span class="pl-k">-</span>i bamos<span class="pl-k">/</span>openface <span class="pl-k">/</span><span class="pl-c1">bin</span><span class="pl-k">/</span>bash</pre></div>

<ul>
<li>Go to cd ./knocking</li>
<li>Run ./knocking.py</li>
<li>Enjoy the demo</li>
</ul>

<h1>
<a id="licensing" class="anchor" href="#licensing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Licensing</h1>

<p>Unless otherwise stated, the source code and trained Torch and Python
model files are copyright Carnegie Mellon University and licensed
under the <a href="./LICENSE">Apache 2.0 License</a>.
Portions from the following third party sources have
been modified and are included in this repository.
These portions are noted in the source files and are
copyright their respective authors with
the licenses listed.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/IoT-Expedition/Edge-Analytics">Edge-analytics</a> is maintained by <a href="https://github.com/IoT-Expedition">IoT-Expedition</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
